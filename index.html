<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integration Mapping Configuration Tool</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState } = React;

        // Icon component
        function Icon({ d, size = 20 }) {
          return React.createElement('svg', {
            width: size,
            height: size,
            viewBox: "0 0 24 24",
            fill: "none",
            stroke: "currentColor",
            strokeWidth: "2",
            strokeLinecap: "round",
            strokeLinejoin: "round"
          }, React.createElement('path', { d: d }));
        }

        const SaveIcon = ({ size }) => React.createElement(Icon, { d: "M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z M17 21v-8H7v8 M7 3v5h8", size: size });
        const UploadIcon = ({ size }) => React.createElement(Icon, { d: "M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4 M17 8l-5-5-5 5 M12 3v12", size: size });
        const DownloadIcon = ({ size }) => React.createElement(Icon, { d: "M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4 M7 10l5 5 5-5 M12 15V3", size: size });
        const PlusIcon = ({ size }) => React.createElement(Icon, { d: "M12 5v14 M5 12h14", size: size });
        const TrashIcon = ({ size }) => React.createElement(Icon, { d: "M3 6h18 M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2", size: size });
        const EditIcon = ({ size }) => React.createElement(Icon, { d: "M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7 M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z", size: size });
        const SettingsIcon = ({ size }) => React.createElement(Icon, { d: "M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z M12 15 A3 3 0 0 1 12 9 A3 3 0 0 1 12 15", size: size });
        const XIcon = ({ size }) => React.createElement(Icon, { d: "M18 6L6 18 M6 6l12 12", size: size });

        function AppointmentMappingForm() {
          const [practiceName, setPracticeName] = useState('');
          const [practiceNameSaved, setPracticeNameSaved] = useState(false);
          const [practiceNameError, setPracticeNameError] = useState(false);
          const [configSaved, setConfigSaved] = useState(false);
          const [showAlert, setShowAlert] = useState(false);
          const [alertMessage, setAlertMessage] = useState('');
          const [showConfirmDialog, setShowConfirmDialog] = useState(false);
          const [confirmAction, setConfirmAction] = useState(null);
          const [confirmMessage, setConfirmMessage] = useState('');
          const [activeTab, setActiveTab] = useState('appointmentTypes');
          const [activeView, setActiveView] = useState('list');
          
          const [availableAppointmentTypes, setAvailableAppointmentTypes] = useState([]);
          const [availableAppointmentPurposes, setAvailableAppointmentPurposes] = useState([]);
          const [availableDoctors, setAvailableDoctors] = useState([]);
          const [availableLocations, setAvailableLocations] = useState([]);
          
          const [mappedAppointmentTypes, setMappedAppointmentTypes] = useState([]);
          const [mappedAppointmentPurposes, setMappedAppointmentPurposes] = useState([]);
          const [mappedDoctors, setMappedDoctors] = useState([]);
          const [mappedLocations, setMappedLocations] = useState([]);
          
          const [categories, setCategories] = useState([]);
          const [selectedItems, setSelectedItems] = useState([]);
          const [showMassEditModal, setShowMassEditModal] = useState(false);
          const [massEditCategories, setMassEditCategories] = useState({});
          const [showAddCategoryModal, setShowAddCategoryModal] = useState(false);
          const [newCategoryName, setNewCategoryName] = useState('');
          const [newCategoryValues, setNewCategoryValues] = useState('');

          const handleFileUpload = async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            try {
              const data = await file.arrayBuffer();
              const workbook = XLSX.read(data);

              const newAppointmentTypes = XLSX.utils.sheet_to_json(workbook.Sheets['Appointment Type'])
                .map(row => row.type).filter(Boolean);
              const newAppointmentPurposes = XLSX.utils.sheet_to_json(workbook.Sheets['Appointment Purpose'])
                .map(row => row.purpose).filter(Boolean);
              const newDoctors = XLSX.utils.sheet_to_json(workbook.Sheets['Doctor'])
                .map(row => row.doctor).filter(Boolean);
              const newLocations = XLSX.utils.sheet_to_json(workbook.Sheets['Location'])
                .map(row => row.location).filter(Boolean);
              const newCategories = XLSX.utils.sheet_to_json(workbook.Sheets['Categories']);

              setAvailableAppointmentTypes(newAppointmentTypes);
              setAvailableAppointmentPurposes(newAppointmentPurposes);
              setAvailableDoctors(newDoctors);
              setAvailableLocations(newLocations);
              setCategories(newCategories);

              showAlertPopup('Data imported successfully!');
            } catch (error) {
              showAlertPopup('Error importing file. Please ensure it matches the template format.');
            }
          };

          const exportTemplate = () => {
            const wb = XLSX.utils.book_new();

            const typeSheet = XLSX.utils.json_to_sheet([{ type: '' }]);
            const purposeSheet = XLSX.utils.json_to_sheet([{ purpose: '' }]);
            const doctorSheet = XLSX.utils.json_to_sheet([{ doctor: '' }]);
            const locationSheet = XLSX.utils.json_to_sheet([{ location: '' }]);
            const categorySheet = XLSX.utils.json_to_sheet([{ Category: '', Values: '' }]);

            XLSX.utils.book_append_sheet(wb, typeSheet, 'Appointment Type');
            XLSX.utils.book_append_sheet(wb, purposeSheet, 'Appointment Purpose');
            XLSX.utils.book_append_sheet(wb, doctorSheet, 'Doctor');
            XLSX.utils.book_append_sheet(wb, locationSheet, 'Location');
            XLSX.utils.book_append_sheet(wb, categorySheet, 'Categories');

            const fileName = 'appointment_import_template.xlsx';
            XLSX.writeFile(wb, fileName);
            showAlertPopup('Empty template exported! Fill in the data and import it back to start mapping.');
          };

          const exportMappingConfiguration = () => {
            if (!practiceName) {
              showAlertPopup('Please enter a practice name before exporting');
              return;
            }

            const wb = XLSX.utils.book_new();

            const mappedTypesData = mappedAppointmentTypes.map(item => {
              const row = { type: item.value };
              categories.forEach(cat => {
                row[cat.Category] = item.categories?.[cat.Category] || '';
              });
              return row;
            });
            const typeSheet = XLSX.utils.json_to_sheet(mappedTypesData);
            
            const mappedPurposesData = mappedAppointmentPurposes.map(item => {
              const row = { purpose: item.value };
              categories.forEach(cat => {
                row[cat.Category] = item.categories?.[cat.Category] || '';
              });
              return row;
            });
            const purposeSheet = XLSX.utils.json_to_sheet(mappedPurposesData);
            
            const mappedDoctorsData = mappedDoctors.map(item => {
              const row = { doctor: item.value };
              categories.forEach(cat => {
                row[cat.Category] = item.categories?.[cat.Category] || '';
              });
              return row;
            });
            const doctorSheet = XLSX.utils.json_to_sheet(mappedDoctorsData);
            
            const mappedLocationsData = mappedLocations.map(item => {
              const row = { location: item.value };
              categories.forEach(cat => {
                row[cat.Category] = item.categories?.[cat.Category] || '';
              });
              return row;
            });
            const locationSheet = XLSX.utils.json_to_sheet(mappedLocationsData);
            
            const categorySheet = XLSX.utils.json_to_sheet(categories);

            XLSX.utils.book_append_sheet(wb, typeSheet, 'Appointment Type');
            XLSX.utils.book_append_sheet(wb, purposeSheet, 'Appointment Purpose');
            XLSX.utils.book_append_sheet(wb, doctorSheet, 'Doctor');
            XLSX.utils.book_append_sheet(wb, locationSheet, 'Location');
            XLSX.utils.book_append_sheet(wb, categorySheet, 'Categories');

            const fileName = `${practiceName.replace(/[^a-z0-9]/gi, '_')}_mapping_config.xlsx`;
            XLSX.writeFile(wb, fileName);
            
            const totalMappings = mappedAppointmentTypes.length + mappedAppointmentPurposes.length + 
                                  mappedDoctors.length + mappedLocations.length;
            showAlertPopup(`Mapping configuration exported successfully!\nFile: ${fileName}\nTotal mappings: ${totalMappings}`);
          };

          const showAlertPopup = (message) => {
            setAlertMessage(message);
            setShowAlert(true);
          };

          const closeAlert = () => {
            setShowAlert(false);
            setAlertMessage('');
          };

          const showConfirmation = (message, onConfirm) => {
            setConfirmMessage(message);
            setConfirmAction(() => onConfirm);
            setShowConfirmDialog(true);
          };

          const handleConfirm = () => {
            if (confirmAction) {
              confirmAction();
            }
            setShowConfirmDialog(false);
            setConfirmAction(null);
          };

          const handleCancel = () => {
            setShowConfirmDialog(false);
            setConfirmAction(null);
          };

          const getCategoryOptions = (categoryName) => {
            const category = categories.find(c => c.Category === categoryName);
            return category ? category.Values.split(',').map(v => v.trim()) : [];
          };

          const toggleSelectItem = (value) => {
            setSelectedItems(prev => 
              prev.includes(value) 
                ? prev.filter(v => v !== value)
                : [...prev, value]
            );
          };

          const toggleSelectAll = () => {
            const currentData = getCurrentData();
            const allItems = [...currentData.available];
            if (selectedItems.length === allItems.length) {
              setSelectedItems([]);
            } else {
              setSelectedItems(allItems);
            }
          };

          const openMassEdit = () => {
            if (selectedItems.length === 0) {
              showAlertPopup('Please select at least one item to edit');
              return;
            }
            setMassEditCategories({});
            setShowMassEditModal(true);
          };

          const applyMassEdit = () => {
            if (selectedItems.length === 0) {
              showAlertPopup('No items selected');
              return;
            }

            let currentMapped = [];
            switch(activeTab) {
              case 'appointmentTypes':
                currentMapped = [...mappedAppointmentTypes];
                break;
              case 'appointmentPurposes':
                currentMapped = [...mappedAppointmentPurposes];
                break;
              case 'doctors':
                currentMapped = [...mappedDoctors];
                break;
              case 'locations':
                currentMapped = [...mappedLocations];
                break;
            }

            selectedItems.forEach(value => {
              const existingIndex = currentMapped.findIndex(m => m.value === value);
              
              if (existingIndex >= 0) {
                const updatedCategories = { ...currentMapped[existingIndex].categories };
                Object.entries(massEditCategories).forEach(([cat, val]) => {
                  if (val !== '') {
                    updatedCategories[cat] = val;
                  }
                });
                currentMapped[existingIndex] = {
                  ...currentMapped[existingIndex],
                  categories: updatedCategories
                };
              } else {
                const newMapping = {
                  value: value,
                  categories: { ...massEditCategories }
                };
                currentMapped.push(newMapping);
              }
            });

            switch(activeTab) {
              case 'appointmentTypes':
                setMappedAppointmentTypes(currentMapped);
                break;
              case 'appointmentPurposes':
                setMappedAppointmentPurposes(currentMapped);
                break;
              case 'doctors':
                setMappedDoctors(currentMapped);
                break;
              case 'locations':
                setMappedLocations(currentMapped);
                break;
            }

            setShowMassEditModal(false);
            setSelectedItems([]);
            showAlertPopup(`Successfully mapped/updated ${selectedItems.length} item(s)`);
          };

          const massDelete = () => {
            if (!selectedItems || selectedItems.length === 0) {
              showAlertPopup('Please select at least one item to delete');
              return;
            }

            const itemCount = selectedItems.length;

            showConfirmation(
              `Are you sure you want to delete ${itemCount} selected item(s)? This will remove them from the list.`,
              () => {
                if (activeTab === 'appointmentTypes') {
                  setMappedAppointmentTypes(mappedAppointmentTypes.filter(m => !selectedItems.includes(m.value)));
                  setAvailableAppointmentTypes(availableAppointmentTypes.filter(v => !selectedItems.includes(v)));
                } else if (activeTab === 'appointmentPurposes') {
                  setMappedAppointmentPurposes(mappedAppointmentPurposes.filter(m => !selectedItems.includes(m.value)));
                  setAvailableAppointmentPurposes(availableAppointmentPurposes.filter(v => !selectedItems.includes(v)));
                } else if (activeTab === 'doctors') {
                  setMappedDoctors(mappedDoctors.filter(m => !selectedItems.includes(m.value)));
                  setAvailableDoctors(availableDoctors.filter(v => !selectedItems.includes(v)));
                } else if (activeTab === 'locations') {
                  setMappedLocations(mappedLocations.filter(m => !selectedItems.includes(m.value)));
                  setAvailableLocations(availableLocations.filter(v => !selectedItems.includes(v)));
                }

                setSelectedItems([]);
                showAlertPopup(`Successfully deleted ${itemCount} item(s)`);
              }
            );
          };

          const deleteMapping = (value) => {
            showConfirmation(
              `Are you sure you want to delete "${value}"? This will remove it from the list.`,
              () => {
                switch(activeTab) {
                  case 'appointmentTypes':
                    setMappedAppointmentTypes(mappedAppointmentTypes.filter(m => m.value !== value));
                    setAvailableAppointmentTypes(availableAppointmentTypes.filter(v => v !== value));
                    break;
                  case 'appointmentPurposes':
                    setMappedAppointmentPurposes(mappedAppointmentPurposes.filter(m => m.value !== value));
                    setAvailableAppointmentPurposes(availableAppointmentPurposes.filter(v => v !== value));
                    break;
                  case 'doctors':
                    setMappedDoctors(mappedDoctors.filter(m => m.value !== value));
                    setAvailableDoctors(availableDoctors.filter(v => v !== value));
                    break;
                  case 'locations':
                    setMappedLocations(mappedLocations.filter(m => m.value !== value));
                    setAvailableLocations(availableLocations.filter(v => v !== value));
                    break;
                }
              }
            );
          };

          const addCategory = () => {
            if (!newCategoryName.trim()) {
              showAlertPopup('Please enter a category name');
              return;
            }
            if (!newCategoryValues.trim()) {
              showAlertPopup('Please enter at least one category value');
              return;
            }
            if (categories.find(c => c.Category === newCategoryName.trim())) {
              showAlertPopup('A category with this name already exists');
              return;
            }

            const newCategory = {
              Category: newCategoryName.trim(),
              Values: newCategoryValues.trim()
            };

            setCategories([...categories, newCategory]);
            setNewCategoryName('');
            setNewCategoryValues('');
            setShowAddCategoryModal(false);
            showAlertPopup(`Category "${newCategory.Category}" added successfully!`);
          };

          const deleteCategory = (categoryName) => {
            showConfirmation(
              `Are you sure you want to delete the category "${categoryName}"? This will remove it from all mappings.`,
              () => {
                setCategories(categories.filter(c => c.Category !== categoryName));
                
                const removeCategoryFromMappings = (mappings) => {
                  return mappings.map(item => {
                    const newCategories = { ...item.categories };
                    delete newCategories[categoryName];
                    return { ...item, categories: newCategories };
                  });
                };

                setMappedAppointmentTypes(removeCategoryFromMappings(mappedAppointmentTypes));
                setMappedAppointmentPurposes(removeCategoryFromMappings(mappedAppointmentPurposes));
                setMappedDoctors(removeCategoryFromMappings(mappedDoctors));
                setMappedLocations(removeCategoryFromMappings(mappedLocations));

                showAlertPopup(`Category "${categoryName}" deleted successfully!`);
              }
            );
          };

          const editCategoryValues = (categoryName, currentValues) => {
            const newValues = prompt(`Edit values for "${categoryName}" (comma-separated):`, currentValues);
            if (newValues !== null && newValues.trim() !== '') {
              setCategories(categories.map(c => 
                c.Category === categoryName 
                  ? { ...c, Values: newValues.trim() }
                  : c
              ));
              showAlertPopup(`Category "${categoryName}" values updated successfully!`);
            }
          };

          const saveAllConfiguration = () => {
            if (!practiceName) {
              setPracticeNameError(true);
              setTimeout(() => setPracticeNameError(false), 3000);
              showAlertPopup('Practice Name is required! Please enter a practice name before saving.');
              return;
            }

            const config = {
              practiceName,
              mappedAppointmentTypes,
              mappedAppointmentPurposes,
              mappedDoctors,
              mappedLocations,
              categories
            };
            
            const totalMappings = mappedAppointmentTypes.length + mappedAppointmentPurposes.length + 
                                  mappedDoctors.length + mappedLocations.length;
            
            console.log('Saved Configuration:', config);
            
            setConfigSaved(true);
            setPracticeNameError(false);
            setTimeout(() => setConfigSaved(false), 5000);
            showAlertPopup(`âœ“ Configuration saved successfully!\n\nPractice Name: ${practiceName}\nTotal Mappings: ${totalMappings}\n  - Appointment Types: ${mappedAppointmentTypes.length}\n  - Appointment Purposes: ${mappedAppointmentPurposes.length}\n  - Doctors/Providers: ${mappedDoctors.length}\n  - Locations: ${mappedLocations.length}`);
          };

          const resetMappings = () => {
            showConfirmation(
              'Are you sure you want to reset all mappings? This will clear all category assignments but keep your imported data and categories.',
              () => {
                setMappedAppointmentTypes([]);
                setMappedAppointmentPurposes([]);
                setMappedDoctors([]);
                setMappedLocations([]);
                setSelectedItems([]);
                showAlertPopup('All mappings have been reset successfully!');
              }
            );
          };

          const resetForm = () => {
            showConfirmation(
              'Are you sure you want to reset the entire form? This will clear ALL data including imported items, mappings, and categories. This action cannot be undone!',
              () => {
                setPracticeName('');
                setAvailableAppointmentTypes([]);
                setAvailableAppointmentPurposes([]);
                setAvailableDoctors([]);
                setAvailableLocations([]);
                setMappedAppointmentTypes([]);
                setMappedAppointmentPurposes([]);
                setMappedDoctors([]);
                setMappedLocations([]);
                setCategories([]);
                setSelectedItems([]);
                setPracticeNameSaved(false);
                setPracticeNameError(false);
                setConfigSaved(false);
                showAlertPopup('Form has been completely reset!');
              }
            );
          };

          const getCurrentData = () => {
            switch(activeTab) {
              case 'appointmentTypes':
                return { 
                  available: availableAppointmentTypes, 
                  mapped: mappedAppointmentTypes,
                  title: 'Appointment Types',
                  label: 'Appointment Type'
                };
              case 'appointmentPurposes':
                return { 
                  available: availableAppointmentPurposes, 
                  mapped: mappedAppointmentPurposes,
                  title: 'Appointment Purposes',
                  label: 'Appointment Purpose'
                };
              case 'doctors':
                return { 
                  available: availableDoctors, 
                  mapped: mappedDoctors,
                  title: 'Doctors/Providers',
                  label: 'Doctor/Provider'
                };
              case 'locations':
                return { 
                  available: availableLocations, 
                  mapped: mappedLocations,
                  title: 'Locations',
                  label: 'Location'
                };
              default:
                return { available: [], mapped: [], title: '', label: '' };
            }
          };

          const currentData = getCurrentData();

          // Render component...
          // [The rest of the JSX continues in the same way]
          
          return <div>Component rendering here - see full artifact</div>;
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(AppointmentMappingForm));
    </script>
</body>
</html>